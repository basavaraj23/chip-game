{{- $cfg := .Values.kafka -}}
apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: {{ $cfg.name }}
  namespace: kafka
spec:
  kafka:
    version: {{ $cfg.version | quote }}
    replicas: {{ $cfg.replicas }}
    storage:
      type: ephemeral
    listeners:
      - name: plain
        port: 9092
        type: internal
        tls: false
{{- if $cfg.retentionMs }}
    config:
      log.retention.ms: {{ $cfg.retentionMs }}
{{- end }}
  zookeeper:
    replicas: 1
    storage:
      type: ephemeral
  entityOperator:
    topicOperator: {}
    userOperator: {}
---
apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaTopic
metadata:
  name: {{ $cfg.topicName | default "chip-moves" }}
  namespace: kafka
  labels:
    strimzi.io/cluster: {{ $cfg.name }}
spec:
  partitions: {{ $cfg.partitions }}
  replicas: {{ $cfg.topicReplicas | default $cfg.replicas }}
