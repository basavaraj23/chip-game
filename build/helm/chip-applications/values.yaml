targets:
  redisNamespace: datastores
  postgresNamespace: datastores
  kafkaNamespace: kafka

# --- Redis (Bitnami) chart source & simple test values ---
redis:
  enabled: true                     # <— ensure your umbrella chart checks this
  repoURL: https://charts.bitnami.com/bitnami
  chart: redis
  version: 23.1.3
  namespace: datastores             # <— optional: if your template reads this
  values:
    architecture: replication
    auth:
      enabled: true
      password: "redispass123"      # test only; use a Secret in prod
    replica:
      replicaCount: 1
    # persistence:
    #   enabled: true               # uncomment if you have a default StorageClass
    #   size: 8Gi

# --- CloudNativePG operator via Argo Application (Helm chart source) ---
cloudnativepg:
  enabled: true
  repoURL: https://cloudnative-pg.github.io/charts
  chart: cloudnative-pg
  version: 0.26.0                   # Use explicit version; avoid "latest" for stability
  destinationNamespace: datastores
  values:
    webhook:
      enabled: false                 # disables webhook (simplifies Kind/localhost use)
    watchNamespaces: ["datastores"]


# --- CNPG cluster via local subchart ---
postgresCluster:
  enabled: true
  repoURL: git@github.com:basavaraj23/chip-game.git
  path: build/helm/postgres-cluster
  destinationNamespace: datastores
  values:
    dbName: chip
    appSecretName: chip-postgres-auth
    appUser: chip_user
    appPass: supersecret
    storageSize: 5Gi

# Strimzi Kafka Operator – 0.47.0 (last release supporting Kafka 3.7)
strimzi:
  enabled: true
  repoURL: https://strimzi.io/charts/
  chart: strimzi-kafka-operator
  version: 0.47.0
  destinationNamespace: argocd
  values:
    watchNamespaces: ["argocd"]

# --- Local Kafka cluster subchart (this repo path) ---
kafkaCluster:
  enabled: true
  repoURL: git@github.com:basavaraj23/chip-game.git
  path: build/helm/kafka-cluster
  targetRevision: main
  destinationNamespace: argocd

# --- Backend app via local subchart ---
chipBackend:
  enabled: true
  repoURL: git@github.com:basavaraj23/chip-game.git 
  path: build/helm/chip-backend
  destinationNamespace: chip
  values:
    image:
      repository: chip-backend
      tag: "v0.1.0"
      pullPolicy: IfNotPresent
    replicas: 1
    service:
      port: 8080
    env:
      # in-cluster addresses
      REDIS_HOST: "redis-master.datastores.svc.cluster.local"
      REDIS_PORT: "6379"
      REDIS_DB: "0"
      REDIS_PASSWORD: "redispass123"  # dev only
      POSTGRES_HOST: "chip-pg-rw.datastores.svc.cluster.local"
      POSTGRES_PORT: "5432"
      POSTGRES_DB: "chip"
      POSTGRES_USER: "chip_user"
      POSTGRES_PASSWORD: "supersecret"
      KAFKA_BROKERS: "chip-kafka-kafka-bootstrap.kafka.svc.cluster.local:9092"
      KAFKA_TOPIC: "chip-moves"

# --- Frontend app via local subchart ---
chipFrontend:
  enabled: true
  repoURL: git@github.com:basavaraj23/chip-game.git
  path: build/helm/chip-frontend
  destinationNamespace: chip
  values:
    image:
      repository: chip-frontend
      tag: "v0.1.0"
      pullPolicy: IfNotPresent
    replicas: 1
    service:
      port: 80
    # browser will call localhost because we'll port-forward backend
    apiBaseUrl: "http://localhost:8080"
